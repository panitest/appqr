<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0"/>
<meta name="apple-mobile-web-app-capable" content="yes"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black"/>
<title>QR</title>
<style>
html,body{ height:100%}
#appcontainer{ position:relative; height:100%}
#btscan{ width:50px; height:50px; position:absolute;cursor:pointer; z-index:500; left:50%; top:50%; margin-left:-25px; margin-top:-25px;}
#resultado{ width:100%; height:100px; text-align:center; font-family:Verdana, Geneva, sans-serif; font-size:16px; color:#000; position:absolute; left:0; top:50%; margin-top:-60px; z-index:500}
</style>
<script type="text/javascript" src="phonegap.js"></script>
<script type="text/javascript" src="js/panino.js"></script>
<script type="text/javascript" src="js/comunes.js"></script>
<script type="text/javascript" src="js/paninoAJAX.js"></script>
<script type="text/javascript" src="js/utils.js"></script>
<script>
function getPage(p,callback){
		request(
			p,
			function(r){
				scrollTo(0,0);
				$('appcontainer').innerHTML=r;
				if(typeof callback=='function'){
					callback();
				}
			},
			{}
		);
}
function getRandomInt(min, max) {
    	return Math.floor(Math.random() * (max - min + 1)) + min;
}
function inArray(needle, haystack) {
    var length = haystack.length;
    for(var i = 0; i < length; i++) {
        if(haystack[i] == needle) return true;
    }
    return false;
}
function save(){
	request(
				'http://onepesoday.com.ar/proceso2.php',
				function(r){
					$('resultado').innerHTML='Los datos han sido guardados<br><img onclick="scan()" src="images/bt_scan.png">';
				},
				{'proceso':'savedata','data':ns.data}
		);
}
function scan(){
	alert(1);
	ns.data=0;
	$('btscan').style.display='none';
	$('resultado').style.display='block';
	$('resultado').innerHTML='<img src="images/ajax-loader.gif">';

 cordova.plugins.barcodeScanner.scan(function(result){
 		ns.data=result.text || 0;
		request(
				'http://onepesoday.com.ar/proceso2.php',
				function(r){
					r=r.trim();
					if(r!='ko'){
						$('resultado').innerHTML=r+'<br><img onclick="save()" src="images/bt_ok.png">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img onclick="scan()" src="images/bt_no.png">';
					}else{
						$('resultado').innerHTML='No se encontraron resultados<br><img onclick="scan()" src="images/bt_no.png">';
					}
				},
				{'proceso':'verdata','data':ns.data}
		);

 },function(error){
 //error callback
	$('resultado').innerHTML='No se encontraron resultados<br><img onclick="scan()" src="images/bt_no.png">';

 });
 }
</script>
</head>

<body>


<div id="appcontainer">
<img id="btscan" src="images/bt_scan.png" onclick="scan();">
<div id="resultado"></div>
</div>
</body>
</html>